= Modä¸Šä¸‹æ–‡APIå‚è€ƒ

https://wiki.melvoridle.com/w/Mod_Creation/Mod_Context_API_Reference[åŸæ–‡åœ°å€,window=_target]

== è®¿é—® Mod ä¸Šä¸‹æ–‡å¯¹è±¡

æœ¬æŒ‡å—ä¸­çš„æ‰€æœ‰ç¤ºä¾‹éƒ½å°†å‡è®¾ä¸€ä¸ªåä¸ºctxçš„ Mod ä¸Šä¸‹æ–‡å¯¹è±¡åœ¨å½“å‰èŒƒå›´å†…ã€‚

=== åœ¨æ¨¡å—ä¸­

åœ¨``manifest.json``ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—è¢«å®šä¹‰ä¸ºä½ çš„æ¨¡ç»„çš„``â€œè®¾ç½®â€ï¼ˆsetupï¼‰``ï¼Œé‚£ä¹ˆå¯¼å‡ºçš„``setup``å‡½æ•°å°†æ¥æ”¶ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå”¯ä¸€çš„å‚æ•°

[source,javascript]
----
export function setup(ctx) {
  // ...
}
----

å¦åˆ™ï¼Œä½¿ç”¨å…¨å±€çš„ `mod.getContext` æ–¹æ³•ï¼Œä¼ å…¥æ‚¨æ¨¡å—çš„å…ƒå¯¹è±¡ï¼š

[source,javascript]
----
const ctx = mod.getContext(import.meta);
----

=== åœ¨è„šæœ¬ä¸­

å¯¹äºè„šæœ¬æ¥è¯´ï¼Œæ¨èçš„æ–¹æ³•æ˜¯ä½¿ç”¨å…¨å±€çš„ `mod.register` æ–¹æ³•ã€‚è¿™åªé€‚ç”¨äºé€šè¿‡ `manifest.json` çš„``â€œloadâ€``å±æ€§æˆ– context å¯¹è±¡çš„ `loadScript` æ–¹æ³•æ³¨å…¥çš„è„šæœ¬ã€‚

[source,javascript]
----
mod.register(ctx => {
  // ...
});
----

=== åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­

æ‰€æœ‰æ¸¸æˆç”Ÿå‘½å‘¨æœŸæ–¹æ³•å›è°ƒä¹Ÿå°†åªæ¥æ”¶åˆ°å„è‡ªmodçš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå”¯ä¸€å‚æ•°ã€‚

[source,javascript]
----
onCharacterLoaded(ctx => {
  // ...
});
----

=== åœ¨å¼€å‘ä¸Šä¸‹æ–‡ä¸­

ä¸ºäº†æ–¹ä¾¿åŸå‹è®¾è®¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…¨å±€çš„ `mod.getDevContext` æ–¹æ³•æ¥è·å–ä¸€ä¸ªç‰¹æ®Šçš„å¼€å‘ mod ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚è¿™ä¸åº”ç”¨äº mod ä¸­ï¼Œä»…ç”¨äºå¼€å‘ç›®çš„ï¼ˆé€šè¿‡æ§åˆ¶å°ï¼‰ã€‚ä»»ä½•éœ€è¦èµ„æºçš„ API éƒ½ä¸ä¼šèµ·ä½œç”¨ï¼Œå› ä¸ºå¼€å‘â€œmodâ€ä¸åŒ…å«ä»»ä½•èµ„æºã€‚

[source,javascript]
----
const devCtx = mod.getDevContext();
----

== è·å–å±æ€§

=== name: string

modçš„åå­—

=== namespace: string | undefined

å®šä¹‰modçš„namespaceï¼Œå¦‚æœæä¾›çš„è¯

=== version: string

å½“å‰åŠ è½½çš„modçš„ç‰ˆæœ¬å·

[[åŠ è½½èµ„æº]]
== åŠ è½½èµ„æº

*ğŸš¨æ‰€æœ‰èµ„æºæ–‡ä»¶è·¯å¾„å¿…é¡»ç›¸å¯¹äºæ‚¨ mod çš„æ ¹ç›®å½•ğŸš¨*

=== getResourceUrl(path: string): string

è·å–æ‚¨çš„ Mod æ‰“åŒ…ä¸­çš„ä»»ä½•èµ„æºçš„å¯ç”¨ URLã€‚

*å‚æ•°*

`path: string` ç”Ÿæˆ URL çš„èµ„æºçš„ç›¸å¯¹è·¯å¾„

*è¿”å›*

`string` è¯·æ±‚çš„èµ„æºçš„URL

*ç¤ºä¾‹*

[source,javascript]
----
const url = ctx.getResourceUrl('sea-shanty-2.ogg');
const song = new Audio(url);
song.loop = true;
song.play();
----

=== loadModule(path: string): Promise<any>

åŠ¨æ€å¯¼å…¥ä¸€ä¸ªJavaScriptæ¨¡å—ã€‚

*å‚æ•°*

`path: string` æ¨¡å—èµ„æºçš„ç›¸å¯¹è·¯å¾„

*è¿”å›*

`Promise<any>` ä¸€ä¸ª Promiseï¼Œè¯¥ Promise å°†è§£æä¸ºåŒ…å«æ¨¡å—å¯¼å‡ºç‰¹æ€§çš„å¯¹è±¡

*ç¤ºä¾‹*

[source,javascript]
----
// my-module.mjs
export function greet(name) {
  console.log(`Hello, ${name}!`);
}
----

[source,javascript]
----
const myModule = await ctx.loadModule('my-module.mjs');
myModule.greet('Melvor'); // Hello, Melvor!
----

=== loadScript(path: string): Promise<void>

å°†ä¸€ä¸ªJavaScriptæ–‡ä»¶æ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚

*å‚æ•°*

`path: string` è„šæœ¬èµ„æºçš„ç›¸å¯¹è·¯å¾„

*è¿”å›*

`Promise<void>` ä¸€ä¸ª Promiseï¼Œå½“æ³¨å…¥çš„è„šæœ¬æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œè¯¥ Promise å°†è§£æ

*ç¤ºä¾‹*

[source,javascript]
----
// Await call if wanting the script to run before continuing
await ctx.loadScript('my-script.js');
// my-script.js has run

// Don't await if no dependency on script
ctx.loadScript('my-independednt-script.js');
// my-independent-script.js has NOT run yet
----

=== loadTemplates(path: string): Promise<void>

å°†ç»™å®š HTML æ–‡ä»¶ä¸­åŒ…å«çš„æ‰€æœ‰ `<template>` å…ƒç´ æ³¨å…¥åˆ°æ–‡æ¡£ä¸»ä½“ä¸­ã€‚

*å‚æ•°*

`path: string` HTML èµ„æºçš„ç›¸å¯¹è·¯å¾„

*è¿”å›*

`Promise<void>` ä¸€ä¸ªåœ¨æ‰€æœ‰æ¨¡æ¿è¢«æ³¨å…¥åˆ°æ–‡æ¡£ä¸»ä½“åè§£æçš„æ‰¿è¯ºã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.loadTemplates('my-templates.html');
----

=== loadStylesheet(path: string): void

å°† CSS æ ·å¼è¡¨æ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚

*å‚æ•°*

`path: string` æ ·å¼è¡¨èµ„æºçš„ç›¸å¯¹è·¯å¾„

*ç¤ºä¾‹*

[source,javascript]
----
ctx.loadStylesheet('my-styles.css');
----

=== loadData(path: string): Promise<any>

ä» JSON èµ„æºåŠ è½½æ•°æ®ã€‚

*å‚æ•°*

`path: string` JSON èµ„æºçš„ç›¸å¯¹è·¯å¾„

*è¿”å›*

`Promise<any>` ä¸€ä¸ªè§£æä¸º JSON å¯¹è±¡çš„æ‰¿è¯ºã€‚

*ç¤ºä¾‹*

[source,json]
----
// my-data.json
{
  "coolThings": [
    "rocks"
  ]
}
----

_JSON ä¸­çš„æ³¨é‡Šä»…ä»…æ˜¯ç¤ºæ„æ€§çš„ï¼Œè€Œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è®°ã€‚_

[source,javascript]
----
// in JavaScript
const myData = await ctx.loadData('my-data.json');
console.log(myData.coolThings); // ['rocks']
----

== å…±äº«èµ„æº

=== share(resourcePath: string): void

å…±äº«ä¸€ä¸ªæ‰“åŒ…çš„ Mod èµ„æºï¼Œä¾›å…¶ä»– Mod ä½¿ç”¨ã€‚

*å‚æ•°*

`resourcePath: string` è¦å…±äº«çš„èµ„æºè·¯å¾„

*ç¤ºä¾‹*

[source,json]
----
// manifest.json
{
  "namespace": "helloMelvor"
}
----

_JSON ä¸­çš„æ³¨é‡Šä»…ä»…æ˜¯ç¤ºæ„æ€§çš„ï¼Œè€Œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è®°ã€‚_

[source,javascript]
----
// in JavaScript
ctx.share('my_cool_image.png');
ctx.share('Greeter.mjs');
----

ç„¶åå…¶ä»–çš„ Mod å¯ä»¥åœ¨ä»»ä½•æ¥å— Mod èµ„æºè·¯å¾„çš„åœ°æ–¹ä½¿ç”¨è¿™ä¸ªèµ„æºã€‚

[source,javascript]
----
ctx.getResourceUrl('helloMelvor:my_cool_image.png');
const { Greeter } = await loadModule('helloMelvor:Greeter.mjs');
const greeter = new Greeter();
----

[[ç”Ÿå‘½å‘¨æœŸé’©å­]]
== ç”Ÿå‘½å‘¨æœŸé’©å­

=== onModsLoaded(callback: (ctx: ModContext) => void | Promise<void>): void

åœ¨æ‰€æœ‰ Mod å·²åŠ è½½åæ‰§è¡Œä»£ç ï¼ˆè§’è‰²é€‰æ‹©å±å¹•ï¼‰ã€‚

*å‚æ•°*

`callback: (ctx: ModContext) => void | Promise<void>` ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶ Mod çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.onModsLoaded(async (ctx) => {
  // ...
});
----

=== onCharacterSelectionLoaded(callback: (ctx: ModContext) => void | Promise<void>): void

åœ¨è§’è‰²é€‰æ‹©å±å¹•å®Œå…¨åŠ è½½åæ‰§è¡Œä»£ç ã€‚

*å‚æ•°*

`callback: (ctx: ModContext) => void | Promise<void>` ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶ Mod çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ã€‚

*ç¤ºä¾‹*ï¼š

[source,javascript]
----
ctx.onCharacterSelectionLoaded(async (ctx) => {
  // ...
});
----

=== onInterfaceAvailable(callback: (ctx: ModContext) => void | Promise<void>): void

åœ¨è§’è‰²åŠ è½½ä¹‹å‰ä½†åœ¨æ¸¸æˆç•Œé¢æœ€åˆè¢«æ³¨å…¥åˆ°é¡µé¢ä¸­ï¼ˆä½†å°šæœªåˆå§‹åŒ–ï¼‰æ‰§è¡Œä»£ç ã€‚ä¸»è¦ç”¨äºæ·»åŠ ç•Œé¢å…ƒç´ ï¼Œç”¨äºè‡ªå®šä¹‰æŠ€èƒ½ï¼Œåœ¨onCharacterLoadedä¹‹å‰éœ€è¦å‡ºç°ã€‚

*å‚æ•°*

callback: (ctx: ModContext) => void | Promise<void> ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶ Mod çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.onInterfaceAvailable(async (ctx) => {
  // ...
});
----

=== onCharacterLoaded(callback: (ctx: ModContext) => void | Promise<void>): void

åœ¨ç©å®¶é€‰æ‹©çš„è§’è‰²åŠ è½½å¹¶åˆ›å»ºæ‰€æœ‰æ¸¸æˆå¯¹è±¡åï¼Œä½†åœ¨ç¦»çº¿è¿›åº¦è®¡ç®—ä¹‹å‰æ‰§è¡Œä»£ç ã€‚

*å‚æ•°*

`callback: (ctx: ModContext) => void | Promise<void>` ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶ Mod çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.onCharacterLoaded(async (ctx) => {
  // ...
});
----

=== onInterfaceReady(callback: (ctx: ModContext) => void | Promise<void>): void

åœ¨ç¦»çº¿è¿›åº¦è¢«è®¡ç®—åï¼Œæ‰€æœ‰æ¸¸æˆå†…ç”¨æˆ·ç•Œé¢å…ƒç´ éƒ½è¢«åˆ›å»ºåæ‰§è¡Œä»£ç ã€‚

*å‚æ•°*

`callback: (ctx: ModContext) => void | Promise<void>` ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶ Mod çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.onInterfaceReady(async (ctx) => {
  // ...
});
----

[[æ³¨å†Œæ¸¸æˆå¯¹è±¡]]
== æ³¨å†Œæ¸¸æˆå¯¹è±¡

æ¸¸æˆå¯¹è±¡æ³¨å†Œ API å¯ä»¥é€šè¿‡æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡çš„ `gameData` å±æ€§æ¥è®¿é—®ã€‚

=== addPackage(data: string | GameDataPackage): Promise<void>

æ³¨å†Œä¸€ä¸ªæ¸¸æˆæ•°æ®åŒ…ã€‚

*å‚æ•°*

`data: string | GameDataPackage` èµ„æºè·¯å¾„åˆ°æ‚¨çš„æ¸¸æˆæ•°æ®åŒ… `.json` æ–‡ä»¶æˆ–è€…æœ‰æ•ˆçš„ JavaScript GameDataPackage å¯¹è±¡ã€‚

*ç¤ºä¾‹*

[source,json]
----
// data.json
{
  "$schema": "https://melvoridle.com/assets/schema/gameData.json",
  "data": {
    // data objects here
  }
}
----

_JSON ä¸­çš„æ³¨é‡Šä»…ä»…æ˜¯ç¤ºæ„æ€§çš„ï¼Œè€Œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è®°ã€‚_

[source,javascript]
----
await ctx.gameData.addPackage('data.json');
----

=== buildPackage(builder: (packageBuilder: GameDataPackageBuilder) => void): BuiltGameDataPackage

ä½¿ç”¨ `GameDataPackageBuilder` API æ„å»ºä¸€ä¸ª GameDataPackage å¯¹è±¡ã€‚

*å‚æ•°*

`builder: (packageBuilder: GameDataPackageBuilder) => void` ç”¨äºå‘æ•°æ®åŒ…æ·»åŠ å•ä¸ªæ¸¸æˆå¯¹è±¡çš„æ„å»ºå™¨ã€‚

*è¿”å›*

`BuiltGameDataPackage` æ¸¸æˆæ•°æ®åŒ…çš„åŒ…è£…å™¨ã€‚è¯·å‚é˜…ä¸‹é¢çš„ä¿¡æ¯ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.gameData.buildPackage((p) => {
  // data registration here
});
----

==== BuiltGameDataPackage.package: GameDataPackage

ï¼ˆPropertyï¼‰å®é™…æ„å»ºçš„ `GameDataPackage` å¯¹è±¡ã€‚

==== BuiltGameDataPackage.add(): void

æ³¨å†Œå·²æ„å»ºçš„æ¸¸æˆæ•°æ®åŒ…ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
const pkg = ctx.gameData.buildPackage((p) => { /* ... */ });
pkg.add();
----

[[Modé…ç½®]]
== Modé…ç½®

NOTE: å½“é€šè¿‡ Creator Toolkit å°†æ‚¨çš„ Mod ä½œä¸ºæœ¬åœ° Mod åŠ è½½æ—¶ï¼Œæ‚¨çš„ Mod å¿…é¡»ä¸ mod.io è¿›è¡Œå…³è”ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»é€šè¿‡ mod.io è®¢é˜…å¹¶å®‰è£…äº†è¯¥ Modï¼Œä»¥ä¾¿ä½¿è¿™äº›æ•°æ®æŒä¹…åŒ–ã€‚

Mod è®¾ç½® API å¯ä»¥é€šè¿‡æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„ `settings` å±æ€§æ¥è®¿é—®ã€‚

=== section(name: string): Section

è·å–æˆ–åˆ›å»ºä¸€ä¸ªè®¾ç½®éƒ¨åˆ†ã€‚éƒ¨åˆ†åˆ›å»ºçš„é¡ºåºå†³å®šäº†å®ƒä»¬åœ¨ Mod è®¾ç½®çª—å£ä¸­çš„æ˜¾ç¤ºé¡ºåºã€‚

*å‚æ•°*

`name: string` éƒ¨åˆ†çš„åç§°ã€‚è¿™å°†æ˜¾ç¤ºä¸ºè®¾ç½®çª—å£ä¸­çš„éƒ¨åˆ†æ ‡é¢˜ã€‚

*è¿”å›*

`Section` éƒ¨åˆ†çš„å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œæ·»åŠ ã€è®¾ç½®æˆ–è·å–è®¾ç½®ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.settings.section('General');
ctx.settings.section('Other');
// Sections will be displayed in the settings window in this order
// 1. General
// 2. Other
----

==== Section.add(config: SettingConfig | SettingConfig[]): void

å‘éƒ¨åˆ†æ·»åŠ è®¾ç½®ã€‚è®¾ç½®æ·»åŠ åˆ°éƒ¨åˆ†çš„é¡ºåºå†³å®šäº†å®ƒä»¬åœ¨ Mod è®¾ç½®çª—å£ä¸­çš„æ˜¾ç¤ºé¡ºåºã€‚

*å‚æ•°*

`config: SettingConfig | SettingConfig[]` è®¾ç½®çš„é…ç½®å¯¹è±¡æˆ–é…ç½®å¯¹è±¡æ•°ç»„ï¼Œä»¥ä¸€æ¬¡æ·»åŠ å¤šä¸ªè®¾ç½®ã€‚è¯·å‚é˜…ä¸‹é¢çš„â€œè®¾ç½®ç±»å‹â€éƒ¨åˆ†ä»¥è·å–è®¾ç½®é…ç½®é€‰é¡¹ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.settings.section('General').add({
  type: 'switch',
  name: 'awesomeness-detection',
  label: 'Awesomeness Detection',
  hint: 'Determines if you are awesome or not.',
  default: false
});

ctx.settings.section('Other').add([{
    type: 'label',
    label: 'I am just a label though my story seldom told...'
  }, {
    type: 'number',
    name: 'pick-a-number',
    label: 'Pick a Number',
    hint: '1 through 10'
}]);
----

==== Section.get(name: string): any

é€šè¿‡å…¶åç§°å±æ€§è·å–è®¾ç½®çš„å½“å‰å€¼ã€‚

*å‚æ•°*

`name: string` è¦è·å–å€¼çš„è®¾ç½®çš„åç§°

*è¿”å›*

`any` è®¾ç½®çš„å½“å‰å€¼

*ç¤ºä¾‹*

[source,javascript]
----
// Assuming the player has typed "1" into the setting
ctx.settings.section('Other').get('pick-a-number'); // 1
----

==== Section.set(name: string, value: any): void

é€šè¿‡å…¶åç§°å±æ€§ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½®è®¾ç½®çš„å€¼ã€‚

*å‚æ•°*

`name: string` è¦è®¾ç½®å€¼çš„è®¾ç½®çš„åç§°

`value: any` è¦è®¾ç½®çš„å€¼

*ç¤ºä¾‹*

[source,javascript]
----
ctx.settings.section('Other').set('pick-a-number', 5);
----

=== type(name: string, config: SettingTypeConfig): void

æ³¨å†Œä¸€ä¸ªè®¾ç½®ç±»å‹ï¼Œç„¶åå¯ä»¥åœ¨æ·»åŠ è®¾ç½®æ—¶ç”±ä»»ä½• Mod ä½¿ç”¨ã€‚

*å‚æ•°*

`name: string` è®¾ç½®ç±»å‹çš„åç§°ã€‚è¿™æ˜¯åœ¨æ·»åŠ æ–°è®¾ç½®æ—¶ç”¨äºè®¾ç½®é…ç½®çš„ç±»å‹å±æ€§ã€‚å…¶ä»– Mod å¿…é¡»åœ¨åç§°å‰åŠ ä¸Šæ‚¨çš„ Mod å‘½åç©ºé—´ã€‚

`config: SettingTypeConfig` å®šä¹‰è®¾ç½®ç±»å‹è¡Œä¸ºçš„å¯¹è±¡ã€‚è¯·å‚è§ä¸‹é¢çš„å®šä¹‰ã€‚

*ç¤ºä¾‹*

[source,json]
----
// manifest.json
{
  "namespace": "my_mod"
  // ...
}
----

_JSON ä¸­çš„æ³¨é‡Šä»…ä»…æ˜¯ç¤ºæ„æ€§çš„ï¼Œè€Œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è®°ã€‚_

[source,javascript]
----
ctx.settings.type('customText', {
  // See example config in SettingTypeConfig section below
});

ctx.settings.section('General').add({
  type: 'customText',
  // ...
});
----

å…¶ä»– Mod å¿…é¡»æ·»åŠ æ‚¨çš„å‘½åç©ºé—´ä»¥ä½¿ç”¨æ‚¨çš„è‡ªå®šä¹‰ç±»å‹ï¼š

[source,javascript]
----
ctx.settings.section('Other').add({
  type: 'my_mod:customText',
  // ...
});
----

[[_settingtypeconfig]]
==== SettingTypeConfig

æ‰€æœ‰å‡½æ•°éƒ½æ˜¯å¿…éœ€çš„ã€‚

===== render(name: string, onChange: () => void, config: SettingConfig): HTMLElement

render å‡½æ•°è´Ÿè´£ä½¿ç”¨ä¼ é€’ç»™é…ç½®çš„å±æ€§æ¥æ¸²æŸ“è®¾ç½®çš„ HTMLã€‚

`name` å‚æ•°å¯åœ¨å¿…è¦æ—¶ç”¨ä½œè®¾ç½®çš„ HTML ä¸­çš„ idã€‚å¸¸è§ç”¨ä¾‹æ˜¯å°† `<input>` çš„ `name` å’Œ `id` å±æ€§è®¾ç½®ä¸ºæ­¤å€¼ï¼Œç„¶åå°† `<label>` çš„ `for` å±æ€§ä¹Ÿè®¾ç½®ä¸ºæ­¤å€¼ã€‚

`onChange` å‚æ•°åº”åœ¨æ›´æ”¹æ­¤è®¾ç½®çš„å€¼æ—¶è°ƒç”¨ã€‚å¸¸è§ç”¨ä¾‹æ˜¯å°†å…¶æ·»åŠ ä¸º `<input>` å…ƒç´ çš„ `change` äº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨ã€‚

`config` å‚æ•°åŒ…å«åœ¨æ·»åŠ æ­¤è®¾ç½®æ—¶ä¼ é€’ç»™é…ç½®å¯¹è±¡çš„æ‰€æœ‰å€¼ã€‚ä¾‹å¦‚ï¼Œ`label`ï¼Œ`hint`ï¼Œ``default``ç­‰å±æ€§ã€‚

ä¸ªåˆ«è®¾ç½®å¯ä»¥é€‰æ‹©åœ¨å…¶ `onChange` æ–¹æ³•ä¸­è¿”å›éªŒè¯é”™è¯¯ã€‚æ‚¨å¯ä»¥åœ¨å…·æœ‰ `validation-message` ç±»çš„å…ƒç´ ä¸­æ˜¾ç¤ºæ­¤éªŒè¯é”™è¯¯çš„ä½ç½®ã€‚

[source,javascript]
----
// The render function for a simple text box
function render(name, onChange, config) {
  const input = document.createElement('input');
  input.id = name;
  input.type = 'text';
  input.name = name;
  input.addEventListener('change', () => onChange());

  const label = document.createElement('label');
  label.for = name;
  label.textContent = config.label;

  if (config.hint) {
    const hint = document.createElement('small');
    hint.textContent = config.hint;
    label.appendChild(hint);
  }

  const validation = document.createElement('small');
  validation.classList.add('text-danger', 'validation-message');

  const root = document.createElement('div');
  root.appendChild(input);
  root.appendChild(label);
  root.appendChild(validation);

  return root;
}
----

===== get(root: HTMLElement): any

`get` å‡½æ•°è´Ÿè´£æ£€ç´¢è®¾ç½®çš„å½“å‰å€¼ã€‚å®ƒåªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³ä» render å‡½æ•°è¿”å›çš„æ ¹ HTML å…ƒç´ ï¼Œè¿™å¯¹äºè·å–å½“å‰å€¼å¯èƒ½ä¼šæœ‰ç”¨ã€‚

[source,javascript]
----
// get function for simple text input defined by above render
function get(root) {
  return root.querySelector('input').value;
}
----

===== set(root: HTMLElement, value: any): void

`set` å‡½æ•°è´Ÿè´£å°† HTML ä¸å½“å‰å€¼ä¿æŒåŒæ­¥ï¼ˆå¦‚æœä»¥ç¼–ç¨‹æ–¹å¼æ›´æ–°ï¼‰ã€‚å®ƒæ¥æ”¶æ¥è‡ª render å‡½æ•°çš„æ ¹ HTML å…ƒç´ å’Œè¦è®¾ç½®çš„å€¼ä½œä¸ºä¸¤ä¸ªå‚æ•°ã€‚

[source,javascript]
----
// set function for simple text setting defined above
function set(root, value) {
  root.querySelector('input').value = value;
}
----

==== ç¤ºä¾‹

[source,javascript]
----
// Use functions defined in above examples as reference
ctx.settings.type('simpleText', {
  render: render,
  get: get,
  set: set
});
----

=== å†…ç½®ç±»å‹

==== åŸºæœ¬è®¾ç½®é…ç½®

æ‰€æœ‰å•ç‹¬çš„è®¾ç½®éƒ½ç»§æ‰¿è¿™ä¸ªåŸºæœ¬è®¾ç½®é…ç½®å¯¹è±¡ã€‚

[source,javascript]
----
interface SettingConfig {
  type: string; // Type of the setting
  name: string; // Name of the setting
  label: string | HTMLElement; // Display label for the setting
  hint: string | HTMLElement; // Small help text to display alongside the setting
  default: any; // Default value for the setting
  onChange(value: any, previousValue: any): void | boolean | string // See notes
}
----

`onChange` é€‰é¡¹æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒæ¥æ”¶æ­£åœ¨è®¾ç½®çš„æ–°å€¼å’Œè®¾ç½®çš„å…ˆå‰å€¼ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥é€‰æ‹©è¿”å›ä¸€ä¸ªå€¼ä½œä¸ºéªŒè¯å™¨ï¼š

* æ— è¿”å›å€¼ / `undefined ` / `true` / éå­—ç¬¦ä¸²çš„çœŸå€¼ï¼ˆnon-stringï¼‰ï¼šéªŒè¯æˆåŠŸï¼Œå…è®¸æ›´æ”¹å€¼ã€‚
* `false` / å‡å€¼ï¼šéªŒè¯å¤±è´¥ï¼Œè®¾ç½®çš„å€¼è¿˜åŸåˆ°ä»¥å‰çš„å€¼ã€‚
* ``string ``å€¼ï¼šéªŒè¯å¤±è´¥ï¼Œè®¾ç½®çš„å€¼è¿˜åŸåˆ°ä»¥å‰çš„å€¼ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²å†…å®¹æ˜¾ç¤ºåœ¨ `.validation-message` å…ƒç´ ä¸­ï¼Œå¦‚æœå¯ç”¨ï¼ˆå‚è§ä¸Šé¢çš„è‡ªå®šä¹‰æ¸²æŸ“ï¼‰ã€‚

==== Text

ä¸€ä¸ªé»˜è®¤æƒ…å†µä¸‹æ¥å—ä»»ä½•å­—ç¬¦çš„ç®€å•æ–‡æœ¬æ¡†ã€‚å€¼çš„ç±»å‹æ˜¯``string``ã€‚

[source,javascript]
----
interface TextConfig implements SettingConfig {
  type: 'text';
  maxLength: number; // Max length attribute for the textbox
}
----

==== Number

ä¸€ä¸ªä»…æ¥å—æ•°å­—çš„ç®€å•æ–‡æœ¬æ¡†ã€‚å€¼çš„ç±»å‹æ˜¯``number``ã€‚

[source,javascript]
----
interface NumberConfig implements SettingConfig {
  type: 'number';
  min: number; // Minimum value to be entered
  max: number; // Maximum value to be entered
}
----

==== Switch

ä¸€ä¸ªæ‰“å¼€/å…³é—­åˆ‡æ¢å¼€å…³ã€‚å€¼çš„ç±»å‹æ˜¯``boolean``ã€‚

[source,javascript]
----
interface SwitchConfig implements SettingConfig {
  type: 'switch'
}
----

==== Dropdown

ä¸€ä¸ªä¸‹æ‹‰æŒ‰é’®ã€‚ä¾‹å¦‚ï¼š"é»˜è®¤åŠ è½½é¡µé¢" æ¸¸æˆè®¾ç½®ã€‚å€¼çš„ç±»å‹æ˜¯``any``ã€‚

[source,javascript]
----
DropdownConfig implements SettingConfig {
  type: 'dropdown';
  color: string; // see Button config
  options: DropdownOption[]; // see note
}
----

`options` é€‰é¡¹å®šä¹‰äº†å¯ä¾›é€‰æ‹©çš„ä¸‹æ‹‰é€‰é¡¹ã€‚ä¸‹æ‹‰é€‰é¡¹çš„ç»“æ„å¦‚ä¸‹ï¼š

[source,javascript]
----
interface DropdownOption {
  value: any; // value that is used by the setting
  display: string | HTMLElement; // display text or element on the option
}
----

==== Button

ä¸€ä¸ªæŒ‰é’®ã€‚å€¼æ˜¯``undefined``çš„ã€‚

[source,javascript]
----
interface ButtonConfig implements SettingConfig {
  type: 'button';
  display: string | HTMLElement; // displayed text or element inside the button
  color: string; // see note
  onClick(): void; // triggered on click of the button
}
----

`color` é€‰é¡¹é™„åŠ åˆ°ä»¥ `btn-` å¼€å¤´çš„ CSS ç±»ï¼Œå¦‚æœæœªå®šä¹‰ï¼Œåˆ™é»˜è®¤ä¸º``primary ``é¢œè‰²ï¼ˆ`btn-primary`ï¼‰ã€‚å¯ç”¨çš„é»˜è®¤é¢œè‰²æœ‰ï¼š

* primary: è“è‰²
* secondary: ç°è‰²
* success: ç»¿è‰²
* info: æµ…è“è‰²
* warning: é»„è‰²
* danger: çº¢è‰²
* dark: æ·±ç°è‰²

==== Checkbox Group

ä¸€ç»„å¤é€‰æ¡†ã€‚å€¼çš„ç±»å‹æ˜¯ä»»ä½•``any[]``ã€‚

[source,javascript]
----
interface CheckboxGroupConfig implements SettingConfig {
  type: 'checkbox-group';
  options: CheckboxOption[]; // see note
}
----

`options` é€‰é¡¹å®šä¹‰äº†å¯ä¾›é€‰æ‹©çš„å¤é€‰æ¡†ã€‚å¤é€‰æ¡†é€‰é¡¹çš„ç»“æ„å¦‚ä¸‹ï¼š

[source,javascript]
----
interface CheckboxOption {
  value: any; // value to be added to array that is set as setting value
  label: string | HTMLElement;
  hint: string | HTMLElement;
}
----

==== Radio Group

ä¸€ç»„å•é€‰æŒ‰é’®ã€‚å€¼çš„ç±»å‹æ˜¯``any``ã€‚

[source,javascript]
----
interface RadioGroupConfig implements SettingConfig {
  type: 'radio-group';
  options: CheckboxOption[]; // see checkbox group's options schema
}
----

==== Label

ä¸€ä¸ªç®€å•çš„æ ‡ç­¾ã€‚å€¼æ˜¯``undefined``çš„ã€‚

[source,javascript]
----
interface LabelConfig implements SettingConfig {
  type: 'label';
}
----

==== è‡ªå®šä¹‰

è‡ªå®šä¹‰æ¸²æŸ“çš„è®¾ç½®ã€‚è¯·å‚é˜…ä¸Šé¢çš„ xref:mod/Modä¸Šä¸‹æ–‡APIå‚è€ƒ.adoc#_settingtypeconfig[SettingTypeConfig] éƒ¨åˆ†ã€‚è¿™ä¸æ³¨å†Œè‡ªå®šä¹‰è®¾ç½®ç±»å‹ä¸åŒï¼Œå› ä¸ºè¿™æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸ä¼šæ³¨å†Œç”¨äºé‡å¤ä½¿ç”¨çš„ç±»å‹ã€‚å€¼çš„ç±»å‹æ˜¯``any``ã€‚

[source,javascript]
----
interface CustomConfig implements SettingConfig, SettingTypeConfig {
  type: 'custom';
}
----

[[å­˜å‚¨è§’è‰²æ•°æ®]]
== å­˜å‚¨è§’è‰²æ•°æ®

NOTE: å½“é€šè¿‡ Creator Toolkit å°†æ‚¨çš„ Mod ä½œä¸ºæœ¬åœ° Mod åŠ è½½æ—¶ï¼Œæ‚¨çš„ Mod å¿…é¡»ä¸ mod.io è¿›è¡Œå…³è”ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»é€šè¿‡ mod.io è®¢é˜…å¹¶å®‰è£…äº†è¯¥ Modï¼Œä»¥ä¾¿ä½¿è¿™äº›æ•°æ®æŒä¹…åŒ–ã€‚

è§’è‰²å­˜å‚¨ API å¯ä»¥é€šè¿‡æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„ `characterStorage` å±æ€§æ¥è®¿é—®ã€‚

=== é™åˆ¶

è§’è‰²å­˜å‚¨åªèƒ½åœ¨åŠ è½½è§’è‰²åä½¿ç”¨ï¼ˆåœ¨ç”Ÿå‘½å‘¨æœŸé’©å­ `onCharacterLoaded` ä¹‹åï¼‰ã€‚

æ¯ä¸ªè§’è‰²å¯ä»¥ä¸ºæ¯ä¸ª Mod å­˜å‚¨å¤šè¾¾ 8,192 å­—èŠ‚ï¼ˆ8KBï¼‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬é”®ã€‚åªèƒ½å­˜å‚¨å¯ JSON åºåˆ—åŒ–çš„æ•°æ®ã€‚è¿™åŒ…æ‹¬åŸå§‹ç±»å‹ï¼ˆ`string`ã€`number`ã€`boolean`ï¼‰ä»¥åŠåªåŒ…å«åŸå§‹ç±»å‹æˆ–å…¶ä»–ç¬¦åˆè¿™ä¸€æè¿°çš„å¯¹è±¡å’Œæ•°ç»„çš„å¯¹è±¡å’Œæ•°ç»„ã€‚è¿™ç§åºåˆ—åŒ–/ååºåˆ—åŒ–æ˜¯è‡ªåŠ¨å¤„ç†çš„ã€‚

=== setItem(key: string, data: any): void

åœ¨è§’è‰²å­˜å‚¨ä¸­è®¾ç½®é”®/å€¼å¯¹ã€‚

*å‚æ•°*

`key: string` ç”¨äºæ ‡è¯†æ­£åœ¨å­˜å‚¨çš„æ•°æ®çš„é”®ã€‚åœ¨è°ƒç”¨ `getItem` å’Œ `removeItem` æ—¶ä½¿ç”¨ã€‚

`data: any` æ•°æ®è¦å­˜å‚¨ã€‚è¯·å‚è§ä¸Šé¢çš„é™åˆ¶ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.characterStorage.setItem('coolThings', ['rocks']);
----

=== getItem(key: string): any

ä»è§’è‰²å­˜å‚¨ä¸­æ ¹æ®é”®è·å–å€¼ã€‚

*å‚æ•°*

`key: string` è¦æ£€ç´¢çš„æ•°æ®çš„é”®

*è¿”å›*

`any` æ•°æ®æ£€ç´¢çš„ç»“æœã€‚å¦‚æœæ²¡æœ‰å­˜å‚¨è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å› `undefined`ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.characterStorage.getItem('coolThings'); // returns ['rocks']
----

=== removeItem(key: string): void

é€šè¿‡é”®ä»è§’è‰²å­˜å‚¨ä¸­ç§»é™¤é”®/å€¼å¯¹ã€‚

*å‚æ•°*

`key: string` è¦ç§»é™¤çš„é”®/å€¼å¯¹çš„é”®ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.characterStorage.removeItem('coolThings');
ctx.characterStorage.getItem('coolThings'); // returns undefined
----

=== clear(): void

ä»è§’è‰²å­˜å‚¨ä¸­ç§»é™¤æ‰€æœ‰é”®/å€¼å¯¹ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.characterStorage.clear();
----

[[å­˜å‚¨è´¦å·æ•°æ®]]
== å­˜å‚¨è´¦å·æ•°æ®

NOTE: å½“é€šè¿‡ Creator Toolkit å°†æ‚¨çš„ Mod ä½œä¸ºæœ¬åœ° Mod åŠ è½½æ—¶ï¼Œæ‚¨çš„ Mod å¿…é¡»ä¸ mod.io è¿›è¡Œå…³è”ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»é€šè¿‡ mod.io è®¢é˜…å¹¶å®‰è£…äº†è¯¥ Modï¼Œä»¥ä¾¿ä½¿è¿™äº›æ•°æ®æŒä¹…åŒ–ã€‚

å¸æˆ·å­˜å‚¨ API å¯ä»¥é€šè¿‡æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„ `accountStorage` å±æ€§æ¥è®¿é—®ã€‚

=== é™åˆ¶

ç”±äºå¸æˆ·æ•°æ®çš„å­˜å‚¨æ–¹å¼æ˜¯åŸºäºäº‘çš„ï¼Œä»¥åŠç©å®¶å¯èƒ½é‡åˆ°çš„æ½œåœ¨ç½‘ç»œé—®é¢˜ï¼Œå¸æˆ·å­˜å‚¨çš„æ•°æ®å®Œæ•´æ€§ä¸èƒ½ 100% ä¿è¯ã€‚å»ºè®®è°¨æ…ä½¿ç”¨å¸æˆ·å­˜å‚¨ã€‚

æ¯ä¸ªå¸æˆ·å¯ä»¥ä¸ºæ¯ä¸ª Mod å­˜å‚¨å¤šè¾¾ 8,192 å­—èŠ‚ï¼ˆ8KBï¼‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬é”®ã€‚åªèƒ½å­˜å‚¨å¯ JSON åºåˆ—åŒ–çš„æ•°æ®ã€‚è¿™åŒ…æ‹¬åŸå§‹ç±»å‹ï¼ˆ`string`ã€`number`ã€`boolean`ï¼‰ä»¥åŠåªåŒ…å«åŸå§‹ç±»å‹æˆ–å…¶ä»–ç¬¦åˆè¿™ä¸€æè¿°çš„å¯¹è±¡å’Œæ•°ç»„çš„å¯¹è±¡å’Œæ•°ç»„ã€‚è¿™ç§åºåˆ—åŒ–/ååºåˆ—åŒ–æ˜¯è‡ªåŠ¨å¤„ç†çš„ã€‚

=== setItem(key: string, data: any): void

åœ¨å¸æˆ·å­˜å‚¨ä¸­è®¾ç½®é”®/å€¼å¯¹ã€‚

*å‚æ•°*

`key: string` ç”¨äºæ ‡è¯†æ­£åœ¨å­˜å‚¨çš„æ•°æ®çš„é”®ã€‚åœ¨è°ƒç”¨ `getItem` å’Œ `removeItem` æ—¶ä½¿ç”¨ã€‚

`data: any` æ•°æ®è¦å­˜å‚¨ã€‚è¯·å‚è§ä¸Šé¢çš„é™åˆ¶ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.accountStorage.setItem('coolThings', ['rocks']);
----

=== getItem(key: string): any

ä»å¸æˆ·å­˜å‚¨ä¸­æ ¹æ®é”®è·å–å€¼ã€‚

*å‚æ•°*

`key: string` è¦æ£€ç´¢çš„æ•°æ®çš„é”®

*è¿”å›*

`any` æ•°æ®æ£€ç´¢çš„ç»“æœã€‚å¦‚æœæ²¡æœ‰å­˜å‚¨è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å› `undefined`ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.accountStorage.getItem('coolThings'); // returns ['rocks']
----

=== removeItem(key: string): void

é€šè¿‡é”®ä»å¸æˆ·å­˜å‚¨ä¸­ç§»é™¤é”®/å€¼å¯¹ã€‚

*å‚æ•°*

`key: string` è¦ç§»é™¤çš„é”®/å€¼å¯¹çš„é”®ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.accountStorage.removeItem('coolThings');
ctx.accountStorage.getItem('coolThings'); // returns undefined
----

=== clear(): void

ä»å¸æˆ·å­˜å‚¨ä¸­ç§»é™¤æ‰€æœ‰é”®/å€¼å¯¹ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.accountStorage.clear();
----

[[æ¸¸æˆå¯¹è±¡ä¿®è¡¥-é’©å­]]
== æ¸¸æˆå¯¹è±¡è¡¥ä¸/é’©å­

=== patch(className: class, methodOrPropertyName: string): MethodPatch | PropertyPatch

è¿™æ˜¯æ–¹æ³•å’Œ getter/setter è¡¥ä¸ API çš„å…¥å£ç‚¹ã€‚æ ¹æ®ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•è¿˜æ˜¯ getter/setter å±æ€§ï¼Œå°†åˆ†åˆ«è¿”å› `MethodPatch` æˆ– `PropertyPatch` å¯¹è±¡ã€‚ç„¶ååº”ä½¿ç”¨ MethodPatch/PropertyPatch å¯¹è±¡æ¥æ‰§è¡ŒæŒ‡å®šç±»å’Œæ–¹æ³•/å±æ€§çš„è¿›ä¸€æ­¥æ“ä½œã€‚

*å‚æ•°*

`className: class` åŒ…å«è¦è¡¥ä¸çš„æ–¹æ³•æˆ– getter/setter çš„ç±»ã€‚åº”è¯¥æ˜¯å®é™…çš„ç±»å¼•ç”¨ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼Œ`Skill`ï¼Œè€Œä¸æ˜¯``'Skill'``ã€‚

`methodOrPropertyName: string` è¦è¡¥ä¸çš„æ–¹æ³•æˆ– getter/setter å±æ€§çš„åç§°ã€‚

*è¿”å›*

`MethodPatch | PropertyPatcch` æŒ‡å®šç±»å’Œæ–¹æ³•æˆ– getter/setter å±æ€§çš„è¡¥ä¸å¯¹è±¡ã€‚è¯·å‚é˜…ä¸‹é¢çš„ç”¨æ³•ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.patch(Skill, 'addXP'); // Returns a MethodPatch
ctx.patch(Skill, 'level'); // Returns a PropertyPatch
----

==== MethodPatch.before(hook: (...args: any) => any[] | void): void

åœ¨æ–¹æ³•ä½“è°ƒç”¨ä¹‹å‰ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ä¼ é€’ç»™æ–¹æ³•è°ƒç”¨çš„å‚æ•°ã€‚å¯é€‰åœ°ï¼Œå›è°ƒå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå€¼æ•°ç»„ï¼Œä»¥è¦†ç›–ä¼ é€’ç»™æ–¹æ³•ä½“çš„å‚æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼ˆè¿”å› `undefined`ï¼‰ï¼Œå‚æ•°å°†ä¿æŒä¸å˜ã€‚

*å‚æ•°*

`hook: (...args: any) => any[] | void` è¦æ‰§è¡Œçš„å›è°ƒé’©å­ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
// Double all XP gains
ctx.patch(Skill, 'addXP').before((amount, masteryAction) => [amount * 2, masteryAction]);
----

==== MethodPatch.after(hook: (returnValue: any, ...args: any) => any | void): void

åœ¨æ–¹æ³•ä½“æ‰§è¡Œå®Œæ¯•åç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•ä½“è¿”å›çš„å€¼ã€‚å…¶ä½™çš„å‚æ•°æ˜¯ä¼ é€’ç»™æ–¹æ³•ä½“çš„å‚æ•°ã€‚å¯é€‰åœ°ï¼Œå›è°ƒå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªæ–°å€¼ä»¥è¦†ç›–æ–¹æ³•çš„è¿”å›å€¼ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼ˆè¿”å› `undefined`ï¼‰ï¼Œåˆ™è¿”å›å€¼å°†ä¿æŒä¸å˜ã€‚

*å‚æ•°*

`hook: (returnValue: any, ...args: any) => any | void` è¦æ‰§è¡Œçš„å›è°ƒé’©å­ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
// The player never misses an attack
ctx.patch(Player, 'rollToHit').after(willHit => {
  if (!willHit) console.log('A miss? I think not!');
  return true;
});
----

==== MethodPatch.replace(replacement: (replacedMethod: (...args: any) => any, ...args: any) => any): void

æ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°æ¥ä»£æ›¿æ–¹æ³•çš„å½“å‰ä½“ã€‚å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«æ›¿æ¢çš„æ–¹æ³•ä½“ã€‚å…¶ä½™çš„å‚æ•°æ˜¯åº”è¯¥ä¼ é€’ç»™æ–¹æ³•çš„å‚æ•°ã€‚å›è°ƒå‡½æ•°çš„è¿”å›å€¼æ˜¯æ–¹æ³•çš„è¿”å›å€¼ã€‚æ›¿ä»£å‡½æ•°ä»ç„¶å—åˆ°åœ¨ `before` å’Œ `after` é’©å­ä¸­å¯¹å‚æ•°/è¿”å›å€¼çš„ä¿®æ”¹çš„å½±å“ã€‚

*å‚æ•°*

`replacement: (replacedMethod: (...args: any) => any, ...args: any) => any` ç”¨äºæ›¿ä»£æ–¹æ³•ä½“çš„å›è°ƒå‡½æ•°ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.patch(Skill, 'addXP').replace(function(o, amount, masteryAction) {
  // Prevent any woodcutting XP
  if (this.id === 'melvorD:Woodcutting') return;

  // Double any mining XP
  if (this.id === 'melvorD:Mining') return o(amount * 2, masteryAction);

  // Grant all other XP as normal
  return o(amount, masteryAction);
});
----

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ `replace` æ–¹æ³•ä¼šæ›¿æ¢å½“å‰çš„æ–¹æ³•ä½“ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡è°ƒç”¨ `replace` æ–¹æ³•çš„æ‰§è¡Œé¡ºåºä¸å®ƒä»¬å£°æ˜çš„é¡ºåºç›¸åï¼š

[source,javascript]
----
const xpPatch = ctx.patch(Skill, 'addXP');

xpPatch.replace((o, amount, masteryAction) => {
  console.log('Replacement #1');
  return o(amount, masteryAction);
});

xpPatch.replace({o, amount, masteryAction) => {
  console.log('Replacement #2');
  return o(amount, masteryAction);
});

game.woodcutting.addXP(100);
// Logs:
// Replacement #2
// Replacement #1
----

==== PropertyPatch.get(getter: (o: () => any) => any): void

åœ¨è®¿é—® getter å±æ€§æ—¶æ‰§è¡Œæä¾›çš„å‡½æ•°å¹¶è¿”å›è¿”å›å€¼ã€‚

*å‚æ•°*

`getter: (o: () => any) => any` è¦æ‰§è¡Œçš„ getter å‡½æ•°ã€‚å‚æ•° `o` æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘è¢«æ›¿æ¢çš„ getter æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ˜¯ä»¥å‰çš„ getter è¡¥ä¸æˆ–åŸå§‹çš„ getter æ–¹æ³•ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
// Effectively double available Township resources
ctx.patch(TownshipResource, 'amount').get((o) => o() * 2);
// Or more practically, make resources unlimited
ctx.patch(TownshipResource, 'amount').get(() => 999999);
----

==== PropertyPatch.set(setter: (o: (value: any) => void, value: any) => void): void

åœ¨è®¿é—® setter å±æ€§æ—¶æ‰§è¡Œæä¾›çš„å‡½æ•°ã€‚

*å‚æ•°*

`setter: (o: (value: any) => void, value: any) => void` è¦æ‰§è¡Œçš„ setter å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•° `o` æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘è¢«æ›¿æ¢çš„ setter æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ˜¯ä»¥å‰çš„ setter è¡¥ä¸æˆ–åŸå§‹çš„ setter æ–¹æ³•ã€‚ç¬¬äºŒä¸ªå‚æ•° `value` åŒ…å«è¢«è®¾ç½®çš„å€¼ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
// Sorry, there aren't many setters in the game to use for a practical example
// Doubles whatever resource amount is being set
ctx.patch(TownshipResource, 'amount').set((o, amount) => o(amount * 2));
// While in-game
game.township.resources.getObjectByID('melvorF:Wood').amount = 1000;
game.township.renderQueue.resourceAmounts = true;
// 2000 wood is available
----

==== PropertyPatch.replace(getter?: (o: () => any) => any, setter?: (o: (value: any) => void, value: any) => void): void

åŒæ—¶è°ƒç”¨ `get` å’Œ `set` çš„åˆ«åã€‚

*å‚æ•°*

`getter: (o: () => any) => any` å‚è§ä¸Šé¢çš„ `get` å‚æ•°ã€‚

`setter: (o: (value: any) => void, value: any) => void` å‚è§ä¸Šé¢çš„ `set` å‚æ•°ã€‚

*ç¤ºä¾‹*

è¯·å‚è§ä¸Šé¢çš„ `get` å’Œ `set` ç¤ºä¾‹ã€‚

=== isPatched(className: class, methodOrPropertyName: string): boolean

æ£€æŸ¥æ–¹æ³•æˆ– getter/setter å±æ€§æ˜¯å¦å·²ç»è¢«æ‰“è¡¥ä¸ã€‚

*å‚æ•°*

`className: class` åŒ…å«è¦æ£€æŸ¥æ˜¯å¦å·²ç»è¢«æ‰“è¡¥ä¸çš„æ–¹æ³•æˆ–å±æ€§çš„ç±»ã€‚åº”è¯¥æ˜¯å®é™…çš„ç±»å¼•ç”¨ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼Œ`Skill`ï¼Œè€Œä¸æ˜¯``'Skill'``ã€‚

`methodOrPropertyName: string` è¦æ£€æŸ¥çš„æ–¹æ³•æˆ–å±æ€§çš„åç§°ã€‚

*è¿”å›*

`boolean` ç»™å®šçš„ç±»æ–¹æ³•æˆ–å±æ€§æ˜¯å¦å·²ç»è¢«æ‰“è¡¥ä¸ã€‚

*ç¤ºä¾‹*

[source,javascript]
----
ctx.isPatched(Skill, 'addXP'); // false
ctx.patch(Skill, 'addXP');
ctx.isPatched(Skill, 'addXP'); // true
----

[[å…¬å¼€å±æ€§ä¸æ–¹æ³•]]
== å…¬å¼€å±æ€§ä¸æ–¹æ³•

æ‚¨å¯èƒ½å¸Œæœ›å…è®¸å…¶ä»– Mod é€šè¿‡æ‚¨å®šä¹‰çš„ API ä¸æ‚¨çš„ Mod è¿›è¡Œäº¤äº’æˆ–é›†æˆã€‚ä¸ºæ­¤ï¼Œæ¨èçš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„ `api` æ–¹æ³•ã€‚é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®šä¹‰ API åï¼Œå…¶ä»– Mod å¯ä»¥é€šè¿‡å…¨å±€çš„ `mod.api['your_mods_namespace']` å¯¹è±¡è®¿é—®å®ƒã€‚

=== api(endpoints?: object): object

æŒ‡å®šè¦åœ¨å…¨å±€ `mod.api['your_mods_namespace']` å¯¹è±¡ä¸Šå…¬å¼€çš„å±æ€§å’Œæ–¹æ³•ã€‚å¯ä»¥å¤šæ¬¡è°ƒç”¨ä»¥æ·»åŠ æ›´å¤šç«¯ç‚¹ã€‚

*å‚æ•°*

`endpoint: object` åŒ…å«æ‚¨è¦å…¬å¼€çš„ä»»ä½•å±æ€§æˆ–æ–¹æ³•çš„å¯¹è±¡ã€‚å¦‚æœçœç•¥ï¼Œå°†åªæ£€ç´¢æ‚¨çš„ Mod çš„å½“å‰ API å¯¹è±¡ã€‚

*è¿”å›*

`object` Mod çš„ API å¯¹è±¡

*ç¤ºä¾‹*

[source,javascript]
----
// manifest.json
{
  "namespace": "helloWorld",
  "setup": "setup.mjs"
}
----

_JSON ä¸­çš„æ³¨é‡Šä»…ç”¨äºç¤ºæ„ï¼Œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è®°ã€‚_

[source,javascript]
----
// setup.mjs
export function setup({ api }) {
  api({
    greet: name => console.log(`Hello, ${name!}`);
  });
}
----

ç„¶åï¼Œå…¶ä»– Mod å°†èƒ½å¤Ÿä¸æ‚¨çš„ API è¿›è¡Œäº¤äº’ï¼š

[source,javascript]
----
// some other mod
mod.api.helloWorld.greet('Melvor'); // Hello, Melvor!
----

include::partial$ModæŒ‡å—è¡¨æ ¼.adoc[]
